{% extends 'curriculum/base.html' %}

{% block extra_css %}
<style>
/* ================= VARIABLES PREMIUM ================= */
:root {
    --negro: #0f172a;
    --morado: #6d28d9;
    --morado-claro: #8b5cf6;
    --fondo: linear-gradient(135deg, #4c1d95, #1e1b4b);
    --blanco: #ffffff;
    --gris: #64748b;
}

/* ================= FONDO GENERAL ================= */
body {
    background: var(--fondo) !important;
    font-family: 'Poppins', sans-serif;
    margin: 0;
    padding: 0;
}

/* ================= TARJETAS PRINCIPALES ================= */
.cv-block {
    background: var(--blanco);
    max-width: 1100px;
    margin: 30px auto;
    padding: 35px;
    border-radius: 18px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.15);
    border: none;
}

/* ================= TITULOS ================= */
.seccion-titulo {
    font-size: 1.4rem;
    font-weight: 800;
    color: var(--negro);
    border-left: 6px solid var(--morado);
    padding-left: 12px;
    margin-bottom: 25px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

/* ================= HEADER PERFIL ================= */
.cv-header-flex {
    display: flex;
    align-items: center;
    gap: 30px;
}

/* FOTO PERFIL */
.cv-photo {
    width: 180px;
    height: 180px;
    border-radius: 50%;
    object-fit: cover;
    border: 5px solid var(--morado);
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
}

/* TEXTO HERO */
.hero-text h1 {
    font-size: 2.4rem;
    font-weight: 900;
    color: var(--negro);
}

.hero-text p {
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--morado);
}

/* ================= GRID DATOS ================= */
.info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 12px;
}

.info-item {
    display: flex;
    justify-content: space-between;
    padding: 10px;
    background: #f8fafc;
    border-radius: 8px;
    font-size: 0.95rem;
}

.info-item strong {
    color: var(--gris);
    font-weight: 600;
}

/* ================= TARJETAS DE CONTENIDO ================= */
.item-card {
    background: #f9fafb;
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 15px;
    border-left: 5px solid var(--morado);
    transition: 0.3s;
}

.item-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.12);
}

/* ================= BADGES ================= */
.badge {
    display: inline-block;
    padding: 6px 14px;
    background: var(--morado);
    color: white;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
}

/* ================= BOTON CERTIFICADO ================= */
.certificado-link {
    display: inline-block;
    margin-top: 10px;
    color: var(--morado);
    font-weight: 600;
    text-decoration: none;
}

.certificado-link:hover {
    text-decoration: underline;
}

/* ================= VENTA GARAGE IMAGEN ================= */
.item-card img {
    max-height: 450px;
    object-fit: contain;
    border-radius: 12px;
    border: 1px solid #e5e7eb;
    background: #fff;
}

/* ================= BOTON PDF ================= */
.pdf-footer-container {
    text-align: center;
    margin: 60px auto;
}

.btn-pdf-final {
    background: var(--morado);
    color: white;
    padding: 14px 40px;
    border-radius: 30px;
    font-weight: 700;
    font-size: 1.1rem;
    text-decoration: none;
    box-shadow: 0 8px 25px rgba(109,40,217,0.5);
    transition: 0.3s;
}

.btn-pdf-final:hover {
    background: var(--morado-claro);
    transform: scale(1.05);
}

/* ================= RESPONSIVE ================= */
@media (max-width: 768px) {
    .cv-header-flex {
        flex-direction: column;
        text-align: center;
    }

    .cv-photo {
        width: 140px;
        height: 140px;
    }
}
</style>

{% endblock %}

{% block content %}
{% if perfil %}

    <div class="cv-block">
        <div class="cv-header-flex">
            {% if perfil.foto_perfil %}
                <img src="{{ perfil.foto_perfil.url }}" alt="Foto" class="cv-photo">
            {% else %}
                <div class="cv-photo" style="background: #eee; display: flex; align-items: center; justify-content: center; color: #666;">Sin Foto</div>
            {% endif %}
            <div class="hero-text">
                <h1>{{ perfil.nombres }} {{ perfil.apellidos }}</h1>
                <p style="color: var(--morado-premium); font-size: 1.4em; font-weight: 600; margin-top: 5px;">
                    {{ perfil.descripcionperfil|default:"Profesional" }}
                </p>
            </div>
        </div>
    </div>

    <div class="cv-block">
        <h2 class="seccion-titulo">Datos Personales</h2>
        <div class="info-grid">
            {% if perfil.numerocedula %}<div class="info-item"><strong>Cédula:</strong><span>{{ perfil.numerocedula }}</span></div>{% endif %}
            {% if perfil.nacionalidad %}<div class="info-item"><strong>Nacionalidad:</strong><span>{{ perfil.nacionalidad }}</span></div>{% endif %}
            {% if perfil.fechanacimiento %}<div class="info-item"><strong>Nacimiento:</strong><span>{{ perfil.fechanacimiento|date:"d/m/Y" }}</span></div>{% endif %}
            {% if perfil.lugarnacimiento %}<div class="info-item"><strong>Lugar:</strong><span>{{ perfil.lugarnacimiento }}</span></div>{% endif %}
            {% if perfil.estadocivil %}<div class="info-item"><strong>Estado Civil:</strong><span>{{ perfil.estadocivil }}</span></div>{% endif %}
            {% if perfil.sexo %}<div class="info-item"><strong>Sexo:</strong><span>{% if perfil.sexo == 'H' %}Hombre{% else %}Mujer{% endif %}</span></div>{% endif %}
            {% if perfil.telefonofijo %}<div class="info-item"><strong>Celular:</strong><span>{{ perfil.telefonofijo }}</span></div>{% endif %}
            {% if perfil.direcciondomiciliaria %}<div class="info-item"><strong>Dirección:</strong><span>{{ perfil.direcciondomiciliaria }}</span></div>{% endif %}
            {% if perfil.sitioweb %}<div class="info-item"><strong>Sitio Web:</strong><span><a href="{{ perfil.sitioweb }}" target="_blank" style="color: var(--morado-premium);">{{ perfil.sitioweb }}</a></span></div>{% endif %}
        </div>
    </div>

    {% if experiencias %}
    <div class="cv-block">
        <h2 class="seccion-titulo">Experiencia Laboral</h2>
        {% for exp in experiencias %}
        <div class="item-card">
            <h4>{{ exp.cargodesempenado }}</h4>
            <p><strong>{{ exp.nombrempresa }}</strong> | {{ exp.lugarempresa }}</p>
            <span class="badge">{{ exp.fechainiciogestion|date:"m/Y" }} - {% if exp.fechafingestion %}{{ exp.fechafingestion|date:"m/Y" }}{% else %}Actualidad{% endif %}</span>
            <p style="margin-top:10px;">{{ exp.descripcionfunciones }}</p>
            {% if exp.rutacertificado %}<a href="{{ exp.rutacertificado.url }}" target="_blank" class="certificado-link">Ver Certificado</a>{% endif %}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    {% if reconocimientos %}
    <div class="cv-block">
        <h2 class="seccion-titulo">Reconocimientos</h2>
        {% for rec in reconocimientos %}
        <div class="item-card">
            <h4>{{ rec.descripcionreconocimiento }}</h4>
            <p><span class="badge">{{ rec.tiporeconocimiento }}</span> | {{ rec.fechareconocimiento|date:"d/m/Y" }}</p>
            <p><strong>Otorgado por:</strong> {{ rec.entidadpatrocinadora }}</p>
            {% if rec.rutacertificado %}<a href="{{ rec.rutacertificado.url }}" target="_blank" class="certificado-link">Ver Certificado</a>{% endif %}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    {% if cursos %}
    <div class="cv-block">
        <h2 class="seccion-titulo">Cursos Realizados</h2>
        {% for curso in cursos %}
        <div class="item-card">
            <h4>{{ curso.nombrecurso }}</h4>
            <p><span class="badge">{{ curso.totalhoras }} horas</span> | {{ curso.fechafin|date:"Y" }}</p>
            <p><strong>Impartido por:</strong> {{ curso.entidadpatrocinadora }}</p>
            {% if curso.rutacertificado %}<a href="{{ curso.rutacertificado.url }}" target="_blank" class="certificado-link">Ver Certificado</a>{% endif %}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    {% if productos_academicos %}
    <div class="cv-block">
        <h2 class="seccion-titulo">Productos Académicos</h2>
        {% for prod in productos_academicos %}
        <div class="item-card">
            <h4>{{ prod.nombrerecurso }}</h4>
            <p><span class="badge">{{ prod.clasificador }}</span></p>
            <p>{{ prod.descripcion }}</p>
            {% if prod.archivo %}<a href="{{ prod.archivo.url }}" target="_blank" class="certificado-link">Ver Archivo</a>{% endif %}
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    {% if ventas %}
    <div class="cv-block">
        <h2 class="seccion-titulo">Venta Garage</h2>
        <div style="display: flex; flex-direction: column; gap: 30px;">
            
            {% for venta in ventas %}
            <div class="item-card" style="width: 100%; border: 1px solid #ddd; padding: 20px; border-radius: 12px; background-color: #fff;">
                
                {% if venta.imagen_producto %}
                <img src="{{ venta.imagen_producto.url }}" alt="{{ venta.nombreproducto }}" 
                style="width: 100%; height: auto; max-height: 600px; object-fit: contain; border-radius: 8px; margin-bottom: 15px; border: 1px solid #f0f0f0;">
                {% endif %}
                
                <h4 style="font-size: 1.4rem; margin-bottom: 10px;">{{ venta.nombreproducto }}</h4>

                <p style="font-size: 0.8rem; color: #888; margin-top: -5px;">
                    Publicado el: {{ venta.fecha_publicacion|date:"d/m/Y" }}
                </p>
                <p style="margin: 15px 0;">
                <span class="badge" style="
                    padding: 6px 12px; 
                    border-radius: 4px; 
                    color: white; 
                    font-weight: bold;
                    background-color: {% if venta.estadoproducto == 'Bueno' %}#28a745{% elif venta.estadoproducto == 'Regular' %}#ffc107{% else %}#dc3545{% endif %};">
                    {{ venta.estadoproducto }}
                </span> 
                <span style="font-size: 1.2rem; margin-left: 10px;">| <strong>${{ venta.valordelbien }}</strong></span>
            </p>

            <p style="line-height: 1.6; color: #333;">{{ venta.descripcion }}</p>
        </div>
        {% endfor %}

    </div> 
</div>
{% endif %}

    <div class="pdf-footer-container">
        <a href="{% url 'curriculum:descargar_pdf' %}" class="btn-pdf-final">
            Descargar Hoja de Vida en PDF
        </a>
    </div>

{% else %}
    <div class="cv-block" style="text-align: center; padding: 100px 20px;">
        <h2>No hay hoja de vida disponible</h2>
    </div>
{% endif %}
{% endblock %}